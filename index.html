<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smooth Auth Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Inter font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

        /* Body styling with Inter font and a dynamic gradient background */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(120deg, #1b5e20, #ffffff, #2e7d32); /* Green, white, green gradient */
            background-size: 400% 400%; /* Larger background for animation */
            animation: gradientMove 12s ease infinite; /* Smooth, infinite gradient movement */
        }

        /* Keyframes for the background gradient animation */
        @keyframes gradientMove {
            0% { background-position: 0% 50%; } /* Start position */
            50% { background-position: 100% 50%; } /* Mid position */
            100% { background-position: 0% 50%; } /* End position, loops back to start */
        }

        /* Glassmorphism card styling */
        .glass-card {
            backdrop-filter: blur(16px) saturate(180%); /* Blur and saturate for glass effect */
            -webkit-backdrop-filter: blur(16px) saturate(180%); /* Webkit prefix for compatibility */
            background-color: rgba(255, 255, 255, 0.4); /* Semi-transparent white background */
            border-radius: 16px; /* Rounded corners */
            /* Neumorphism-like shadow for depth */
            box-shadow: 8px 8px 20px rgba(0,0,0,0.1), /* Outer shadow (dark) */
                        -8px -8px 20px rgba(255,255,255,0.5), /* Outer shadow (light) */
                        inset 4px 4px 6px rgba(255,255,255,0.6), /* Inner shadow (light) */
                        inset -4px -4px 6px rgba(0,0,0,0.05); /* Inner shadow (dark) */
        }

        /* Modal transition styles */
        .modal {
            transition: opacity 0.3s ease; /* Smooth fade transition */
        }

        /* Hidden state for modals */
        .hidden-modal {
            opacity: 0;
            pointer-events: none; /* Prevents interaction when hidden */
        }

        /* Show state for modals */
        .show-modal {
            opacity: 1;
            pointer-events: auto; /* Allows interaction when shown */
        }

        /* OTP input styling */
        .otp-input-group {
            display: flex;
            justify-content: center;
            gap: 0.5rem; /* Space between individual OTP input boxes */
        }
        .otp-input {
            width: 2.5rem; /* Fixed width for each input box */
            height: 2.5rem; /* Fixed height for each input box */
            text-align: center; /* Center align text inside */
            font-size: 1.25rem; /* Large font size for digits */
            border-radius: 0.5rem; /* Rounded corners for input boxes */
            border: 1px solid #ccc; /* Light grey border */
            background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent background */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); /* Inner shadow for depth */
            transition: border-color 0.2s, box-shadow 0.2s; /* Smooth transition on focus */
        }
        .otp-input:focus {
            outline: none; /* Remove default outline */
            border-color: #2e7d32; /* Green border on focus */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1), 0 0 0 3px rgba(46, 125, 50, 0.3); /* Green glow on focus */
        }

        /* Neumorphism inner shadow for general input fields (excluding OTP inputs) */
        input:not(.otp-input), textarea {
            /* Removed the light inner shadow to remove the "lighting" effect */
            box-shadow: inset -4px -44px 6px rgba(0,0,0,0.05); /* Dark inner shadow only */
        }

        /* Loading Overlay Styles */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white; /* White screen as requested */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Ensure it's on top of everything */
            opacity: 0; /* Initially hidden */
            visibility: hidden; /* Initially hidden */
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out; /* Smooth transition */
        }

        /* Loading Circle Container */
        #loading-circle {
            width: 120px; /* Slightly larger for better wave visibility */
            height: 120px;
            border-radius: 50%;
            overflow: hidden; /* Crucial: clips children to the circle shape */
            position: relative; /* For absolute positioning of children */
            background-color: #e0e0e0; /* Light grey background for the empty part of the circle */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1); /* Subtle inner shadow for depth */
        }

        /* The actual water that fills */
        #water-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%; /* Starts empty */
            background-color: #2e7d32; /* Green color for the water */
            animation: fillWater 5s ease-in-out forwards; /* Fill animation for 5 seconds */
        }

        /* The wave effect on top of the water */
        #water-fill::before {
            content: '';
            position: absolute;
            /* Position slightly above the current fill level to create the wave crest */
            top: -15px; /* Adjust this value to control wave height relative to the water surface */
            left: -25%; /* Starts outside the left edge of the circle */
            width: 150%; /* Wider than the circle to enable horizontal movement */
            height: 30px; /* Height of the wave visual */
            background: #2e7d32; /* Same color as the water */
            border-radius: 50% 50% 0 0 / 100% 100% 0 0; /* Creates the curved wave top */
            animation: waveMovement 2s linear infinite; /* Horizontal wave movement */
            z-index: 1; /* Ensures the wave is on top of the #water-fill div */
        }

        /* Keyframes for water filling */
        @keyframes fillWater {
            0% { height: 0%; }
            100% { height: 100%; } /* Fills completely */
        }

        /* Keyframes for horizontal wave movement */
        @keyframes waveMovement {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } /* Moves the wave across its wider width */
        }

        /* Class to show the loading overlay */
        .show-loading {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Avatar Selection Styles */
        .avatar-option {
            border: 3px solid transparent; /* Default border */
        }
        .avatar-option.selected {
            border-color: #2e7d32; /* Green border when selected */
        }
        .avatar-option .overlay {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .avatar-option.selected .overlay {
            opacity: 1; /* Show overlay when selected */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="w-full p-4 flex justify-between items-center">
        <div class="text-2xl font-bold transition-all duration-700 opacity-100" id="logo" data-en="Dr WEEE" data-ar="دكتور وى">🌿 Dr WEEE</div>
        <div class="space-x-2 rtl:space-x-reverse">
            <button id="signInBtn" onclick="openModal('signin')" class="px-4 py-2 bg-white/30 backdrop-blur rounded-lg shadow hover:bg-white/50 transition text-sm sm:text-base" data-en="Sign In" data-ar="تسجيل الدخول">Sign In</button>
            <button id="signUpBtn" onclick="openModal('signup')" class="px-4 py-2 bg-white/30 backdrop-blur rounded-lg shadow hover:bg-white/50 transition text-sm sm:text-base" data-en="Sign Up" data-ar="إنشاء حساب">Sign Up</button>
        </div>
    </header>

    <main class="flex-1 flex items-center justify-center text-xl sm:text-3xl text-gray-800 font-semibold px-4 text-center">
        <div id="placeholder-text" data-en="Add catchy text here" data-ar="أضف نصًا جذابًا هنا">Help Us To Change The World</div>
        <div id="admin-home-page" class="hidden text-center">
            <h1 class="text-4xl font-bold text-green-700 mb-4">
                <span data-en="Welcome," data-ar="أهلاً بك،">Welcome,</span> <span id="admin-username"></span>!
            </h1>
            <p class="text-lg text-gray-700" data-en="You have access to administrative features." data-ar="لديك صلاحية الوصول إلى الميزات الإدارية.">You have access to administrative features.</p>
            <button onclick="logout()" class="mt-8 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl shadow-lg" data-en="Logout" data-ar="تسجيل الخروج">Logout</button>
        </div>
        <div id="user-home-page" class="hidden text-center">
            <h1 class="text-4xl font-bold text-gray-700 mb-4">
                <span data-en="Welcome," data-ar="أهلاً بك،">Welcome,</span> <span id="user-username"></span>!
            </h1>
            <p class="text-lg text-gray-700" data-en="Explore our features." data-ar="استكشف ميزاتنا.">Explore our features.</p>
            <button onclick="logout()" class="mt-8 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl shadow-lg" data-en="Logout" data-ar="تسجيل الخروج">Logout</button>
        </div>
    </main>

    <div class="absolute bottom-4 left-4">
        <select id="lang" onchange="switchLang(this.value)" class="bg-white/60 px-3 py-1 rounded-lg shadow">
            <option value="en">English</option>
            <option value="ar">العربية</option>
        </select>
    </div>

    <div id="modal-overlay" onclick="closeModal()" class="fixed inset-0 bg-black/30 flex items-center justify-center z-40 hidden-modal modal">
        <div id="signin-modal" onclick="event.stopPropagation()" class="glass-card w-11/12 max-w-md p-6 relative z-50 hidden">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-xl text-gray-500 hover:text-gray-700">&times;</button>
            <h2 class="text-center text-2xl font-semibold mb-4" data-en="Welcome Back" data-ar="مرحبًا بعودتك">Welcome Back</h2>
            <form class="space-y-4" onsubmit="handleSignIn(event)">
                <input type="email" id="signin-email" placeholder="Email" data-en-placeholder="Email" data-ar-placeholder="البريد الإلكتروني" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                <div class="relative">
                    <input type="password" id="signin-password" placeholder="Password" data-en-placeholder="Password" data-ar-placeholder="كلمة المرور" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none pr-10" />
                    <span class="absolute right-3 top-3 cursor-pointer text-gray-500 hover:text-gray-700" onclick="togglePassword('signin-password', this)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </span>
                </div>
                <div class="text-right">
                    <a href="#" onclick="event.preventDefault(); openModal('forgot-password');" class="text-sm text-green-700 hover:underline" data-en="Forgot Password?" data-ar="هل نسيت كلمة المرور؟">Forgot Password?</a>
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg" data-en="Sign In" data-ar="تسجيل الدخول">Sign In</button>
                <p id="signin-message" class="text-center text-sm mt-4 text-red-600"></p>
            </form>
        </div>

        <div id="signup-modal" onclick="event.stopPropagation()" class="glass-card w-11/12 max-w-md p-6 relative z-50 hidden">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-xl text-gray-500 hover:text-gray-700">&times;</button>
            <h2 class="text-center text-2xl font-semibold mb-4" data-en="Create an Account" data-ar="إنشاء حساب">Create an Account</h2>
            <form class="space-y-4" onsubmit="handleSignUp(event)">
                <input type="text" id="signup-fullname" placeholder="Full Name" data-en-placeholder="Full Name" data-ar-placeholder="الاسم الكامل" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                <input type="tel" placeholder="Phone Number" data-en-placeholder="Phone Number" data-ar-placeholder="رقم الهاتف" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                <input type="email" id="signup-email" placeholder="Email" data-en-placeholder="Email" data-ar-placeholder="البريد الإلكتروني" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                <div class="relative">
                    <input type="password" id="signup-password" placeholder="Password" data-en-placeholder="Password" data-ar-placeholder="كلمة المرور" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none pr-10" />
                    <span class="absolute right-3 top-3 cursor-pointer text-gray-500 hover:text-gray-700" onclick="togglePassword('signup-password', this)">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </span>
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg" data-en="Sign Up" data-ar="إنشاء حساب">Sign Up</button>
                <p id="signup-message" class="text-center text-sm mt-4 text-red-600"></p>
            </form>

            <!-- Text for "Sign in with" -->
            <div class="text-center text-gray-700 text-sm mb-4" data-en="OR" data-ar="او">OR</div>

            <div class="flex justify-center space-x-4">
                <button class="flex items-center justify-center w-12 h-12 border border-gray-300 rounded-full shadow-sm text-gray-700 bg-white hover:bg-gray-50 transition" title="Continue with Google" data-social-login="Google">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" xmlns="https://imagepng.org/wp-content/uploads/2019/08/google-icon.png">
                        <path d="M12.24 10.285V14.4h6.818c-.275 1.432-.976 2.827-2.025 3.864l-4.708 4.708-1.127-.976c2.51-2.908 3.97-6.942 3.97-11.232 0-.74-.06-1.46-.175-2.16H12.24z" fill="#4285F4"/>
                        <path d="M12.24 2.835c2.296 0 4.382.788 5.92 2.072l4.708-4.708C19.022.42 15.772-.005 12.24-.005 7.18 0 2.768 2.91 0 7.185l4.708 3.63c1.23-3.69 4.67-6.35 7.532-6.35z" fill="#34A853"/>
                        <path d="M12.24 21.615c-2.862 0-6.302-2.66-7.532-6.35L0 17.27c2.768 4.275 7.18 7.185 12.24 7.185 3.532 0 6.782-1.29 9.27-3.815l-4.708-3.63c-1.538 1.284-3.624 2.072-5.92 2.072z" fill="#FBBC05"/>
                        <path d="M24.48 12.285c0-.8-.067-1.58-.19-2.33H12.24v4.11h6.818c-.275 1.432-.976 2.827-2.025 3.864l-4.708 4.708v-4.708l1.127-.976c2.51-2.908 3.97-6.942 3.97-11.232 0-.74-.06-1.46-.175-2.16H12.24z" fill="#EA4335"/>
                    </svg>
                </button>
                <button class="flex items-center justify-center w-12 h-12 border border-gray-300 rounded-full shadow-sm text-gray-700 bg-white hover:bg-gray-50 transition" title="Continue with Apple" data-social-login="Apple">
                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C8.68 0 6.09 2.18 5.06 5.06c-.84 2.37.15 4.96 2.18 6.55 1.3 1.03 2.86 1.76 4.54 2.11 1.76.35 3.55.22 5.25-.38 1.7-.6 3.06-1.84 3.92-3.48.86-1.64.92-3.52.17-5.26-1.03-2.37-3.12-3.95-5.59-4.57C12.82.04 12.41 0 12 0zm0 2.2c.41 0 .82.04 1.22.12 2.04.41 3.75 1.76 4.61 3.72.63 1.45.54 3.07-.26 4.47-.79 1.4-2.14 2.4-3.75 2.81-1.61.41-3.26.32-4.8-.26-1.53-.58-2.76-1.64-3.48-3.03-.72-1.39-.78-2.97-.2-4.43.6-1.46 1.79-2.58 3.25-3.03C10.18 2.24 11.09 2.2 12 2.2zM8.5 16c-.28 0-.5.22-.5.5v2c0 .28.22.5.5.5h7c.28 0 .5-.22.5-.5v-2c0-.28-.22-.5-.5-.5h-7zm0 3.5c-.28 0-.5.22-.5.5v2c0 .28.22.5.5.5h7c.28 0 .5-.22.5-.5v-2c0-.28-.22-.5-.5-.5h-7z"/>
                    </svg>
                </button>
                <button class="flex items-center justify-center w-12 h-12 border border-gray-300 rounded-full shadow-sm text-gray-700 bg-white hover:bg-gray-50 transition" title="Continue with Facebook" data-social-login="Facebook">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.35C0 23.407.593 24 1.325 24h11.498v-9.294H9.692V11.23h3.131V8.71c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.76V11.23h3.587l-.467 3.473h-3.12V24h6.115c.732 0 1.325-.593 1.325-1.325V1.325C24 .593 23.407 0 22.675 0z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div id="forgot-password-modal" onclick="event.stopPropagation()" class="glass-card w-11/12 max-w-md p-6 relative z-50 hidden">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-xl text-gray-500 hover:text-gray-700">&times;</button>
            <h2 class="text-center text-2xl font-semibold mb-4" data-en="Reset Password" data-ar="إعادة تعيين كلمة المرور">Reset Password</h2>
            <form class="space-y-4" id="forgot-password-form">
                <div id="phone-input-section">
                    <p class="text-center text-sm mb-2">
                        <span data-en="Your registered phone number is:" data-ar="رقم هاتفك المسجل هو:">Your registered phone number is:</span>
                        <span id="masked-phone-display" class="font-semibold text-gray-800"></span>
                    </p>
                    <input type="tel" id="forgot-phone" placeholder="Enter Phone Number" data-en-placeholder="Enter Phone Number" data-ar-placeholder="أدخل رقم الهاتف" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                    <button type="button" onclick="checkPhoneNumber()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg mt-4" data-en="Next" data-ar="التالي">Next</button>
                </div>
                <div id="email-for-otp-section" class="hidden">
                    <p class="text-center text-sm mb-2" data-en="We will send a verification code to:" data-ar="سوف نرسل رمز التحقق إلى:"></p>
                    <p id="masked-email-display" class="text-center text-lg font-semibold text-gray-800 mb-4"></p>
                    <input type="email" id="forgot-email" placeholder="Confirm Email" data-en-placeholder="Confirm Email" data-ar-placeholder="تأكيد البريد الإلكتروني" required class="w-full px-4 py-2 rounded-xl shadow-inner border focus:outline-none" />
                    <button type="button" onclick="sendOtp()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg mt-4" data-en="Send Code" data-ar="إرسال الرمز">Send Code</button>
                </div>
            </form>
            <p id="forgot-password-message" class="text-center text-sm mt-4 text-red-600"></p>
        </div>

        <div id="otp-modal" onclick="event.stopPropagation()" class="glass-card w-11/12 max-w-md p-6 relative z-50 hidden">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-xl text-gray-500 hover:text-gray-700">&times;</button>
            <h2 class="text-center text-2xl font-semibold mb-4" data-en="Verify Your Account" data-ar="تحقق من حسابك">Verify Your Account</h2>
            <p class="text-center text-sm mb-4" id="otp-instruction-message" data-en="Please enter the 6-digit code sent to your email." data-ar="الرجاء إدخال الرمز المكون من 6 أرقام المرسل إلى بريدك الإلكتروني."></p>
            <form class="space-y-4">
                <div class="otp-input-group">
                    <input type="text" id="otp-1" maxlength="1" class="otp-input" />
                    <input type="text" id="otp-2" maxlength="1" class="otp-input" />
                    <input type="text" id="otp-3" maxlength="1" class="otp-input" />
                    <span class="text-gray-500 text-2xl">-</span> <input type="text" id="otp-4" maxlength="1" class="otp-input" />
                    <input type="text" id="otp-5" maxlength="1" class="otp-input" />
                    <input type="text" id="otp-6" maxlength="1" class="otp-input" />
                </div>
                <p id="otp-message" class="text-center text-sm mt-4 text-red-600"></p>
                <button type="button" onclick="verifyOtp()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg mt-4" data-en="Verify Code" data-ar="تحقق من الرمز">Verify Code</button>
            </form>
            <div class="text-center mt-4">
                <p class="text-sm text-gray-600" data-en="Didn't receive the code?" data-ar="لم تتلق الرمز؟"></p>
                <a href="#" onclick="event.preventDefault(); resendOtp();" class="text-sm text-green-700 hover:underline" data-en="Resend it again" data-ar="إعادة إرساله">Resend it again</a>
            </div>
        </div>

        <div id="avatar-modal" onclick="event.stopPropagation()" class="glass-card w-11/12 max-w-md p-6 relative z-50 hidden">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-xl text-gray-500 hover:text-gray-700">&times;</button>
            <h2 class="text-center text-2xl font-semibold mb-4" data-en="Choose Your Avatar" data-ar="اختر صورتك الرمزية">Choose Your Avatar</h2>
            <div id="avatar-selection-grid" class="grid grid-cols-3 gap-4 justify-items-center">
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar1">
                    <img src="https://via.placeholder.com/96/FF5733/FFFFFF?text=A1" alt="Avatar 1" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar2">
                    <img src="https://via.placeholder.com/96/33FF57/FFFFFF?text=A2" alt="Avatar 2" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar3">
                    <img src="https://via.placeholder.com/96/3357FF/FFFFFF?text=A3" alt="Avatar 3" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar4">
                    <img src="https://via.placeholder.com/96/FFFF33/000000?text=A4" alt="Avatar 4" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar5">
                    <img src="https://via.placeholder.com/96/FF33FF/FFFFFF?text=A5" alt="Avatar 5" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
                <div class="avatar-option w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer relative overflow-hidden transition-all duration-300 hover:scale-105" data-avatar-id="avatar6">
                    <img src="https://via.placeholder.com/96/33FFFF/000000?text=A6" alt="Avatar 6" class="w-full h-full object-cover rounded-full">
                    <div class="overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
            </div>
            <button onclick="selectAvatar()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-xl py-2 shadow-lg mt-6" data-en="Confirm Selection" data-ar="تأكيد الاختيار">Confirm Selection</button>
            <p id="avatar-message" class="text-center text-sm mt-4 text-red-600"></p>
        </div>
    </div>

    <div id="loading-overlay" class="show-loading">
        <div id="loading-circle">
            <div id="water-fill"></div>
        </div>
    </div>

    <script>
        // Simulate a stored user phone number and email for demonstration purposes.
        // In a real application, these would come from a backend or user session.
        let simulatedStoredPhoneNumber = "1234567890"; // Example stored phone number
        let simulatedStoredEmail = "user@example.com"; // Example stored email

        // Simulated list of admin emails
        const simulatedAdminEmails = [
            'adham@drweee.com',
            'essam@drweee.com',
            'sally@drweee.com',
            'mo@drweee.com',
            'mohanad@drweee.com'
        ];
        // Simulated user data (for demonstration of login)
        // Each user object now includes 'name', 'avatar', and 'verified' properties
        const simulatedUsers = {
            'user@example.com': { password: 'password123', name: 'Regular User', avatar: 'avatar1', verified: true },
            'adham@drweee.com': { password: 'adminpass1', name: 'Adham', avatar: 'avatar2', verified: true },
            'essam@drweee.com': { password: 'adminpass2', name: 'Essam', avatar: 'avatar3', verified: true },
            'sally@drweee.com': { password: 'adminpass3', name: 'Sally', avatar: 'avatar4', verified: true },
            'mo@drweee.com': { password: 'adminpass4', name: 'Mo', avatar: 'avatar5', verified: true },
            'mohanad@drweee.com': { password: 'adminpass5', name: 'Mohanad', avatar: 'avatar6', verified: true }
        };

        // Global variable to track OTP purpose
        let otpPurpose = null; // 'signup' or 'forgot-password'
        let otpTargetEmail = null; // Email to which OTP is sent

        // Global variable to store the selected avatar during signup flow
        let selectedAvatarId = null;
        let pendingUserEmailForAvatar = null; // Store email for avatar assignment after OTP

        /**
         * Shows the loading animation overlay.
         */
        function showLoadingScreen() {
            document.getElementById('loading-overlay').classList.add('show-loading');
            // Reset water fill animation for subsequent logins/signups
            const waterFill = document.getElementById('water-fill');
            waterFill.style.animation = 'none'; // Temporarily remove animation
            waterFill.offsetHeight; // Trigger reflow
            waterFill.style.animation = null; // Reapply animation
        }

        /**
         * Hides the loading animation overlay.
         */
        function hideLoadingScreen() {
            document.getElementById('loading-overlay').classList.remove('show-loading');
        }

        /**
         * Opens a specified modal and hides all other modals.
         * Resets the state of the forgot password and OTP modals.
         * @param {string} type - The type of modal to open ('signin', 'signup', 'forgot-password', 'otp', 'avatar').
         */
        function openModal(type) {
            const modalOverlay = document.getElementById('modal-overlay');
            // Show the modal overlay
            modalOverlay.classList.remove('hidden-modal');
            modalOverlay.classList.add('show-modal');

            // Hide all modals initially
            document.getElementById('signin-modal').classList.add('hidden');
            document.getElementById('signup-modal').classList.add('hidden');
            document.getElementById('forgot-password-modal').classList.add('hidden');
            document.getElementById('otp-modal').classList.add('hidden');
            document.getElementById('avatar-modal').classList.add('hidden'); // Ensure avatar modal is hidden by default

            // Reset forgot password and OTP modals state (existing logic)
            document.getElementById('phone-input-section').classList.remove('hidden'); // Show phone input
            document.getElementById('forgot-phone').classList.remove('hidden'); // Ensure phone input is visible
            document.getElementById('email-for-otp-section').classList.add('hidden'); // Hide email section
            document.getElementById('forgot-password-message').textContent = ''; // Clear messages
            document.getElementById('forgot-phone').value = ''; // Clear phone input
            document.getElementById('forgot-email').value = ''; // Clear email input
            document.getElementById('masked-phone-display').classList.remove('hidden'); // Ensure masked phone display is visible
            document.getElementById('masked-email-display').textContent = ''; // Clear masked email display

            // Clear OTP inputs and messages
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`otp-${i}`).value = '';
            }
            document.getElementById('otp-message').textContent = '';
            document.getElementById('signin-message').textContent = ''; // Clear sign-in messages
            document.getElementById('signup-message').textContent = ''; // Clear sign-up messages

            // Reset OTP purpose and target email when opening any modal, unless it's the OTP modal itself being opened by an OTP flow
            if (type !== 'otp') {
                otpPurpose = null;
                otpTargetEmail = null;
            }

            // Display the requested modal
            if (type === 'signin') {
                document.getElementById('signin-modal').classList.remove('hidden');
            } else if (type === 'signup') {
                document.getElementById('signup-modal').classList.remove('hidden');
            } else if (type === 'forgot-password') {
                document.getElementById('forgot-password-modal').classList.remove('hidden');
                updateMaskedPhoneNumberDisplay(); // Display the masked stored phone number
                otpPurpose = 'forgot-password'; // Set purpose when opening forgot password
            } else if (type === 'otp') {
                document.getElementById('otp-modal').classList.remove('hidden');
                // otpPurpose and otpTargetEmail should be set by the calling function (e.g., handleSignUp, sendOtp)
            } else if (type === 'avatar') {
                document.getElementById('avatar-modal').classList.remove('hidden');
                document.getElementById('avatar-message').textContent = ''; // Clear avatar message
                // Reset avatar selection visual state
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.classList.remove('selected');
                    option.querySelector('.overlay').classList.add('hidden');
                });
                selectedAvatarId = null; // Clear previously selected avatar
            }
        }

        /**
         * Closes all open modals and hides the modal overlay.
         */
        function closeModal() {
            const modalOverlay = document.getElementById('modal-overlay');
            // Hide the modal overlay
            modalOverlay.classList.add('hidden-modal');
            modalOverlay.classList.remove('show-modal');

            // Hide all modals
            document.getElementById('signin-modal').classList.add('hidden');
            document.getElementById('signup-modal').classList.add('hidden');
            document.getElementById('forgot-password-modal').classList.add('hidden');
            document.getElementById('otp-modal').classList.add('hidden');
            document.getElementById('avatar-modal').classList.add('hidden');
        }

        /**
         * Switches the language of the page between English and Arabic.
         * Updates text content, placeholders, and directional properties (LTR/RTL).
         * @param {string} lang - The language code ('en' for English, 'ar' for Arabic).
         */
        function switchLang(lang) {
            localStorage.setItem('lang', lang); // Store selected language in local storage
            document.documentElement.lang = lang; // Set HTML lang attribute
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'; // Set text direction

            // Update text content and placeholder attributes
            document.querySelectorAll('[data-en], [data-en-placeholder]').forEach(el => {
                if (el.dataset.en) {
                    // Special handling for welcome messages to preserve the username span
                    if (el.id === 'admin-home-page' || el.id === 'user-home-page') {
                        // Do nothing here, as the span inside will be updated separately
                    } else {
                        el.textContent = lang === 'ar' ? el.dataset.ar : el.dataset.en;
                    }
                }
                if (el.dataset.enPlaceholder) {
                    el.placeholder = lang === 'ar' ? el.dataset.arPlaceholder : el.dataset.enPlaceholder;
                }
                // Apply text-right for inputs in RTL context, and adjust padding for password icon
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    if (lang === 'ar') {
                        el.classList.add('text-right');
                        if (el.type === 'password') {
                            el.classList.remove('pr-10');
                            el.classList.add('pl-10');
                        }
                    } else {
                        el.classList.remove('text-right');
                        if (el.type === 'password') {
                            el.classList.remove('pl-10');
                            el.classList.add('pr-10');
                        }
                    }
                }
            });

            // Adjust password icon position based on language
            document.querySelectorAll('.relative .absolute').forEach(iconSpan => {
                const parentInput = iconSpan.previousElementSibling;
                if (parentInput && parentInput.type === 'password') {
                    if (lang === 'ar') {
                        iconSpan.classList.remove('right-3');
                        iconSpan.classList.add('left-3');
                    } else {
                        iconSpan.classList.remove('left-3');
                        iconSpan.classList.add('right-3');
                    }
                }
            });

            // Update masked phone and email display on language change
            updateMaskedPhoneNumberDisplay();
            updateMaskedEmailDisplay();

            const logo = document.getElementById('logo');
            logo.style.opacity = 0;
            setTimeout(() => {
                logo.textContent = lang === 'ar' ? '🌿 شعار' : '🌿 LOGO';
                logo.style.opacity = 1;
            }, 300);

            // Re-render the welcome message to apply correct language for "Welcome," part
            const currentUserEmail = localStorage.getItem('loggedInUserEmail');
            if (currentUserEmail && simulatedUsers[currentUserEmail]) {
                const userName = simulatedUsers[currentUserEmail].name;
                showHomePage(currentUserEmail, userName);
            }
        }

        /**
         * Toggles the visibility of a password input field and changes the eye icon.
         * @param {string} id - The ID of the password input field.
         * @param {HTMLElement} iconSpan - The span element containing the eye icon.
         */
        function togglePassword(id, iconSpan) {
            const field = document.getElementById(id);
            if (field.type === 'password') {
                field.type = 'text'; // Change to text to show password
                // Update icon to 'eye-slash' (hidden)
                iconSpan.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                `;
            } else {
                field.type = 'password'; // Change to password to hide
                // Update icon to 'eye' (visible)
                iconSpan.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .988-3.13 3.393-5.594 6.457-6.737m.91-1.077A9.95 9.95 0 0112 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7a10.05 10.05 0 01-1.875-.175"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6"></path></svg>
                `;
            }
        }

        /**
         * Updates the display of the masked stored phone number in the "Forgot Password" modal.
         * Masks the middle digits for privacy.
         */
        function updateMaskedPhoneNumberDisplay() {
            const maskedPhoneDisplay = document.getElementById('masked-phone-display');
            if (simulatedStoredPhoneNumber) {
                // Mask the phone number: first 3 digits, then 6 asterisks, then last 2 digits
                const maskedNumber = simulatedStoredPhoneNumber.substring(0, 3) + '******' + simulatedStoredPhoneNumber.substring(simulatedStoredPhoneNumber.length - 2);
                maskedPhoneDisplay.textContent = maskedNumber;
            } else {
                maskedPhoneDisplay.textContent = ''; // Clear if no number is stored
            }
        }

        /**
         * Updates the display of the masked stored email in the "Forgot Password" modal.
         * Masks part of the email username for privacy.
         */
        function updateMaskedEmailDisplay() {
            const maskedEmailDisplay = document.getElementById('masked-email-display');
            if (simulatedStoredEmail) {
                // Mask email: first 3 chars, then ***, then @domain.com
                const atIndex = simulatedStoredEmail.indexOf('@');
                let maskedEmail = '';
                if (atIndex > 3) {
                    maskedEmail = simulatedStoredEmail.substring(0, 3) + '***' + simulatedStoredEmail.substring(atIndex);
                } else {
                    maskedEmail = '***' + simulatedStoredEmail.substring(atIndex); // If username is too short
                }
                maskedEmailDisplay.textContent = maskedEmail;
            } else {
                    maskedEmailDisplay.textContent = ''; // Clear if no email is stored
                }
            }

        /**
         * Handles the phone number check in the "Forgot Password" flow.
         * Simulates verification against a stored number and proceeds to email confirmation if successful.
         */
        function checkPhoneNumber() {
            const phoneNumberInput = document.getElementById('forgot-phone');
            const phoneNumber = phoneNumberInput.value;
            const messageElement = document.getElementById('forgot-password-message');
            const phoneSection = document.getElementById('phone-input-section');
            const emailForOtpSection = document.getElementById('email-for-otp-section');
            
            // Simulate checking the entered phone number against the stored one
            if (phoneNumber === simulatedStoredPhoneNumber) {
                messageElement.textContent = ''; // Clear any previous error messages
                
                // Hide the phone input section and show the email section
                phoneSection.classList.add('hidden');
                emailForOtpSection.classList.remove('hidden');
                updateMaskedEmailDisplay(); // Display the masked email for confirmation

                // Re-apply translation for email placeholder if language is Arabic
                const currentLang = localStorage.getItem('lang') || 'en';
                if (currentLang === 'ar') {
                    document.getElementById('forgot-email').placeholder = document.getElementById('forgot-email').dataset.arPlaceholder;
                    document.getElementById('forgot-email').classList.add('text-right');
                } else {
                    document.getElementById('forgot-email').placeholder = document.getElementById('forgot-email').dataset.enPlaceholder;
                    document.getElementById('forgot-email').classList.remove('text-right');
                }
            } else {
                // Display error message if phone number does not match
                messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'رقم الهاتف غير مطابق للسجل.' : 'Phone number does not match our records.';
            }
        }

        /**
         * Simulates sending an OTP to the user's email and opens the OTP verification modal.
         */
        function sendOtp() {
            const messageElement = document.getElementById('forgot-password-message'); // Used for forgot password flow messages
            const otpInstructionMessage = document.getElementById('otp-instruction-message');

            let emailToSendTo = '';
            if (otpPurpose === 'forgot-password') {
                emailToSendTo = document.getElementById('forgot-email').value;
                if (!emailToSendTo || emailToSendTo.toLowerCase() !== simulatedStoredEmail.toLowerCase()) {
                    messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'البريد الإلكتروني غير مطابق للسجل.' : 'Email does not match our records.';
                    return;
                }
            } else if (otpPurpose === 'signup') {
                emailToSendTo = otpTargetEmail; // Use the email from signup form
            }

            if (!emailToSendTo) {
                otpInstructionMessage.textContent = localStorage.getItem('lang') === 'ar' ? 'حدث خطأ في تحديد البريد الإلكتروني.' : 'Error determining email.';
                openModal('otp'); // Open OTP modal with error
                return;
            }

            // Simulate sending an actual OTP
            console.log("Simulating OTP sent to:", emailToSendTo, "for purpose:", otpPurpose);
            
            closeModal(); // Close current modal
            openModal('otp'); // Open the OTP modal

            otpInstructionMessage.textContent = localStorage.getItem('lang') === 'ar' ? `الرجاء إدخال الرمز المكون من 6 أرقام المرسل إلى ${emailToSendTo}.` : `Please enter the 6-digit code sent to ${emailToSendTo}.`;
            document.getElementById('otp-message').textContent = ''; // Clear any old OTP messages
        }

        /**
         * Verifies the entered OTP against a simulated correct OTP.
         */
        function verifyOtp() {
            let otp = '';
            // Concatenate values from all OTP input fields
            for (let i = 1; i <= 6; i++) {
                otp += document.getElementById(`otp-${i}`).value;
            }
            const otpMessageElement = document.getElementById('otp-message');

            // Simulate OTP verification
            if (otp === '123456') { // Example correct OTP
                otpMessageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'تم التحقق بنجاح!' : 'Verification successful!';
                otpMessageElement.classList.remove('text-red-600');
                otpMessageElement.classList.add('text-green-600');
                
                if (otpPurpose === 'signup') {
                    // Mark user as verified and proceed to avatar selection
                    simulatedUsers[otpTargetEmail].verified = true;
                    pendingUserEmailForAvatar = otpTargetEmail; // Set email for avatar assignment
                    
                    closeModal(); // Close OTP modal
                    openModal('avatar'); // Open avatar selection
                    // The actual showHomePage will happen after avatar selection
                } else if (otpPurpose === 'forgot-password') {
                    // For forgot password, proceed to password reset (simulated here)
                    otpMessageElement.textContent += (localStorage.getItem('lang') === 'ar' ? ' يمكنك الآن إعادة تعيين كلمة المرور.' : ' You can now reset your password.');
                    // In a real app, you would redirect to a password reset page.
                }
            } else {
                otpMessageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'رمز التحقق غير صحيح. حاول مرة أخرى.' : 'Invalid OTP. Please try again.';
                otpMessageElement.classList.remove('text-green-600');
                otpMessageElement.classList.add('text-red-600');
            }
        }

        /**
         * Simulates resending the OTP.
         */
        function resendOtp() {
            const otpMessageElement = document.getElementById('otp-message');
            console.log("Simulating OTP resend...");
            otpMessageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'تمت إعادة إرسال الرمز. يرجى التحقق.' : 'Code resent. Please check.';
            otpMessageElement.classList.remove('text-red-600');
            otpMessageElement.classList.add('text-green-600');
            // Clear OTP inputs after resending
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`otp-${i}`).value = '';
            }
        }

        /**
         * Handles the sign-in form submission.
         * Simulates authentication and redirects based on user role (admin/regular user).
         * @param {Event} event - The form submission event.
         */
        function handleSignIn(event) {
            event.preventDefault(); // Prevent default form submission
            const emailInput = document.getElementById('signin-email');
            const passwordInput = document.getElementById('signin-password');
            const messageElement = document.getElementById('signin-message');

            const email = emailInput.value;
            const password = passwordInput.value;

            // Simulate authentication
            if (simulatedUsers[email] && simulatedUsers[email].password === password) {
                if (!simulatedUsers[email].verified) {
                    messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'الرجاء التحقق من بريدك الإلكتروني أولاً.' : 'Please verify your email first.';
                    messageElement.classList.add('text-red-600');
                    messageElement.classList.remove('text-green-600');
                    // Optionally, prompt them to resend OTP or open OTP modal
                    otpPurpose = 'signup'; // Treat as if they need to complete signup verification
                    otpTargetEmail = email;
                    setTimeout(() => { // Give a moment for the message to be read
                        closeModal();
                        sendOtp(); // Automatically send OTP for unverified user
                    }, 1500);
                    return;
                }

                messageElement.textContent = ''; // Clear any previous messages
                closeModal(); // Close the sign-in modal
                showLoadingScreen(); // Show loading animation

                const userName = simulatedUsers[email].name;
                localStorage.setItem('loggedInUserEmail', email); // Store email to retrieve name on lang switch

                // Simulate loading time before redirecting to home page
                setTimeout(() => {
                    hideLoadingScreen(); // Hide loading animation
                    showHomePage(email, userName); // Pass username to display
                }, 5000); // 5 seconds delay for animation
            } else {
                messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'البريد الإلكتروني أو كلمة المرور غير صحيحة.' : 'Invalid email or password.';
            }
        }

        /**
         * Handles the sign-up form submission.
         * Now initiates email OTP verification.
         * @param {Event} event - The form submission event.
         */
        function handleSignUp(event) {
            event.preventDefault(); // Prevent default form submission
            const fullNameInput = document.getElementById('signup-fullname');
            const emailInput = document.getElementById('signup-email');
            const passwordInput = document.getElementById('signup-password');
            const messageElement = document.getElementById('signup-message');

            const fullName = fullNameInput.value;
            const email = emailInput.value;
            const password = passwordInput.value;

            // Simulate social login for demonstration
            // In a real app, these would trigger OAuth flows
            if (event.submitter && event.submitter.dataset.socialLogin) {
                const socialProvider = event.submitter.dataset.socialLogin;
                console.log(`Simulating login with ${socialProvider}`);
                messageElement.textContent = localStorage.getItem('lang') === 'ar' ? `المتابعة باستخدام ${socialProvider} (محاكاة)` : `Continuing with ${socialProvider} (simulated)`;
                messageElement.classList.remove('text-red-600');
                messageElement.classList.add('text-green-600');

                // Simulate successful social login leading to home page
                closeModal();
                showLoadingScreen();
                const simulatedSocialUserEmail = `${socialProvider.toLowerCase()}@example.com`;
                const simulatedSocialUserName = `${socialProvider} User`;
                // Add a dummy entry for this social user if not exists
                if (!simulatedUsers[simulatedSocialUserEmail]) {
                    simulatedUsers[simulatedSocialUserEmail] = {
                        password: 'socialpass', // Dummy password
                        name: simulatedSocialUserName,
                        avatar: 'avatar1', // Default avatar
                        verified: true
                    };
                }
                localStorage.setItem('loggedInUserEmail', simulatedSocialUserEmail);

                setTimeout(() => {
                    hideLoadingScreen();
                    showHomePage(simulatedSocialUserEmail, simulatedSocialUserName);
                }, 5000); // 5 seconds delay for animation
                return; // Stop further processing for social login
            }


            if (simulatedUsers[email]) {
                messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'هذا البريد الإلكتروني مسجل بالفعل.' : 'This email is already registered.';
                messageElement.classList.remove('text-green-600');
                messageElement.classList.add('text-red-600');
            } else {
                // Store new user data temporarily (not yet verified, no avatar)
                simulatedUsers[email] = { password: password, name: fullName, avatar: null, verified: false };

                otpPurpose = 'signup'; // Set OTP purpose for sign-up
                otpTargetEmail = email; // Set the email for OTP verification
                
                messageElement.textContent = localStorage.getItem('lang') === 'ar' ? 'تم إنشاء الحساب بنجاح! يتم إرسال رمز التحقق...' : 'Account created successfully! Sending verification code...';
                messageElement.classList.remove('text-red-600');
                messageElement.classList.add('text-green-600');

                // Close signup modal and proceed to OTP verification
                closeModal();
                sendOtp(); // Trigger OTP sending
            }
        }

        /**
         * Logic for avatar selection after signup/OTP.
         */
        function selectAvatar() {
            const avatarMessage = document.getElementById('avatar-message');
            if (selectedAvatarId) {
                if (pendingUserEmailForAvatar && simulatedUsers[pendingUserEmailForAvatar]) {
                    simulatedUsers[pendingUserEmailForAvatar].avatar = selectedAvatarId;
                    console.log(`User ${pendingUserEmailForAvatar} selected avatar: ${selectedAvatarId}`);
                    
                    avatarMessage.textContent = localStorage.getItem('lang') === 'ar' ? 'تم اختيار صورتك الرمزية بنجاح!' : 'Avatar selected successfully!';
                    avatarMessage.classList.remove('text-red-600');
                    avatarMessage.classList.add('text-green-600');

                    closeModal(); // Close avatar modal
                    showLoadingScreen(); // Show loading animation

                    localStorage.setItem('loggedInUserEmail', pendingUserEmailForAvatar); // Store email

                    setTimeout(() => {
                        hideLoadingScreen();
                        showHomePage(pendingUserEmailForAvatar, simulatedUsers[pendingUserEmailForAvatar].name);
                        pendingUserEmailForAvatar = null; // Clear pending email
                    }, 5000); // 5 seconds delay for animation
                } else {
                    avatarMessage.textContent = localStorage.getItem('lang') === 'ar' ? 'حدث خطأ. يرجى محاولة تسجيل الدخول.' : 'An error occurred. Please try signing in.';
                    avatarMessage.classList.remove('text-green-600');
                    avatarMessage.classList.add('text-red-600');
                }
            } else {
                avatarMessage.textContent = localStorage.getItem('lang') === 'ar' ? 'الرجاء اختيار صورة رمزية.' : 'Please choose an avatar.';
                avatarMessage.classList.remove('text-green-600');
                avatarMessage.classList.add('text-red-600');
            }
        }

        /**
         * Determines which home page to show based on the logged-in user's email and displays their name.
         * @param {string} email - The email of the logged-in user.
         * @param {string} userName - The name of the logged-in user.
         */
        function showHomePage(email, userName) {
            document.getElementById('placeholder-text').classList.add('hidden');
            document.getElementById('admin-home-page').classList.add('hidden');
            document.getElementById('user-home-page').classList.add('hidden');

            const currentLang = localStorage.getItem('lang') || 'en';
            const welcomeText = currentLang === 'ar' ? 'أهلاً بك،' : 'Welcome,';

            if (simulatedAdminEmails.includes(email)) {
                document.getElementById('admin-home-page').classList.remove('hidden');
                document.getElementById('admin-username').textContent = userName; // Set the admin's name
                // Update the full welcome string to ensure correct concatenation with translated "Welcome,"
                document.querySelector('#admin-home-page h1').innerHTML = `${welcomeText} <span id="admin-username">${userName}</span>!`;
            } else {
                document.getElementById('user-home-page').classList.remove('hidden');
                document.getElementById('user-username').textContent = userName; // Set the user's name
                // Update the full welcome string to ensure correct concatenation with translated "Welcome,"
                document.querySelector('#user-home-page h1').innerHTML = `${welcomeText} <span id="user-username">${userName}</span>!`;
            }
            // Hide sign-in/sign-up buttons and show logout
            document.getElementById('signInBtn').classList.add('hidden');
            document.getElementById('signUpBtn').classList.add('hidden');
        }

        /**
         * Handles user logout, clearing the session and returning to the initial state.
         */
        function logout() {
            document.getElementById('placeholder-text').classList.remove('hidden');
            document.getElementById('admin-home-page').classList.add('hidden');
            document.getElementById('user-home-page').classList.add('hidden');
            // Show sign-in/sign-up buttons
            document.getElementById('signInBtn').classList.remove('hidden');
            document.getElementById('signUpBtn').classList.remove('hidden');
            // Clear input fields in sign-in modal
            document.getElementById('signin-email').value = '';
            document.getElementById('signin-password').value = '';
            localStorage.removeItem('loggedInUserEmail'); // Clear stored email on logout
        }


        // Event listener for when the DOM content is fully loaded
        window.addEventListener('DOMContentLoaded', () => {
            // Load saved language preference from local storage or default to English
            const savedLang = localStorage.getItem('lang') || 'en';
            document.getElementById('lang').value = savedLang; // Set dropdown value
            switchLang(savedLang); // Apply the saved language

            // Auto-focus and move to next OTP input field logic
            document.querySelectorAll('.otp-input-group .otp-input').forEach((input, index, array) => {
                // Listen for input events (when a character is typed)
                input.addEventListener('input', () => {
                    // If the current input is filled and it's not the last one, move focus to the next
                    if (input.value.length === input.maxLength && index < array.length - 1) {
                        array[index + 1].focus();
                    }
                });
                // Listen for keydown events (for backspace navigation)
                input.addEventListener('keydown', (event) => {
                    // If Backspace is pressed, the current input is empty, and it's not the first input,
                    // move focus to the previous input
                    if (event.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        array[index - 1].focus();
                    }
                });
            });

            // Event listener for avatar selection
            document.getElementById('avatar-selection-grid').addEventListener('click', (event) => {
                const avatarOption = event.target.closest('.avatar-option');
                if (avatarOption) {
                    // Remove 'selected' class and hide overlay from all others
                    document.querySelectorAll('.avatar-option').forEach(option => {
                        option.classList.remove('selected');
                        option.querySelector('.overlay').classList.add('hidden');
                    });

                    // Add 'selected' class and show overlay to the clicked one
                    avatarOption.classList.add('selected');
                    avatarOption.querySelector('.overlay').classList.remove('hidden');
                    selectedAvatarId = avatarOption.dataset.avatarId;
                }
            });

            // Hide the loading overlay immediately on page load
            hideLoadingScreen();

            // Check if a user was previously logged in (e.g., after a page refresh)
            const lastLoggedInEmail = localStorage.getItem('loggedInUserEmail');
            if (lastLoggedInEmail && simulatedUsers[lastLoggedInEmail]) {
                showHomePage(lastLoggedInEmail, simulatedUsers[lastLoggedInEmail].name);
            }
        });
    </script>
</body>
</html>
